<!DOCTYPE html>
<html lang="en">
    <head>
        
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-K2VQTGFM');</script>
        

        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Upload Health Report - Meow Yourself</title>
        <style>
            @import url(https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;700&display=swap);
            @import url(https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200);
            *, :after, :before {
                border: 0 solid #e5e7eb;
                box-sizing: border-box;
            }
            body {
                margin: 0;
                overflow-x: hidden;
                font-size: 16px;
                line-height: 1.7;
                color: #2f2a25;
                font-family: 'Noto Serif TC', 'Source Han Serif TC', 'Songti TC', serif;
                background-color: #f6f5f3;
                background-image: linear-gradient(160deg, #f6f5f3 0%, #faf9f7 45%, #fdfbf8 100%);
            }
            #webcrumbs .warm-shell {
                background: linear-gradient(180deg, #fdfbf8 0%, #f6f5f3 60%, #faf9f7 100%);
            }
            #webcrumbs .warm-surface {
                background: linear-gradient(160deg, rgba(253, 251, 248, 0.95) 0%, rgba(246, 245, 243, 0.95) 100%);
            }
            #webcrumbs .warm-cta {
                background: linear-gradient(135deg, #f4d7c3 0%, #e8c3ad 100%);
                color: #5b4032;
                border: 1px solid rgba(205, 175, 154, 0.6);
            }
            #webcrumbs .warm-cta:hover {
                background: linear-gradient(135deg, #ebcdb7 0%, #dfb49a 100%);
                color: #4b3326;
            }
            #webcrumbs .warm-divider {
                border-bottom: 1px solid rgba(210, 198, 188, 0.6);
            }
            #webcrumbs .warm-border {
                border: 1px solid rgba(210, 200, 190, 0.7);
            }
            #webcrumbs .warm-note {
                background: linear-gradient(135deg, rgba(249, 237, 230, 0.9) 0%, rgba(233, 209, 194, 0.9) 100%);
            }
            .status-card {
                background: #f4ece5;
                border: 1px solid rgba(210, 188, 170, 0.35);
                border-radius: 20px;
                padding: 24px 28px;
                text-align: center;
                box-shadow: 0 8px 20px rgba(110, 83, 63, 0.08);
            }
            .status-title {
                margin: 0 0 8px;
                font-size: 1.15rem;
                font-weight: 600;
                color: #3c2f26;
            }
            .status-subtitle {
                margin: 0 0 16px;
                font-size: 0.95rem;
                color: #6f5e52;
            }
            .status-disclaimer {
                margin-top: 24px;
                font-size: 0.85rem;
                color: #8b796c;
                text-align: center;
            }
            @media (max-width: 640px) {
                .status-card {
                    text-align: left;
                }
                .status-disclaimer {
                    text-align: left;
                }
            }
            #webcrumbs .warm-menu {
                background-color: rgba(210, 171, 148, 0.9);
                border: none;
                box-shadow: 0 6px 16px rgba(110, 83, 63, 0.16);
                width: auto !important; 
                min-width: 88px;
                border-radius: 9999px;
                padding: 4px 12px;
            }
            #webcrumbs .warm-menu-link {
                color: #4d3528;
                text-align: center; 
                padding: 4px 0 !important;
                font-weight: 600;
            }
            #webcrumbs .warm-menu-link:hover {
                background-color: transparent;
                color: #3a271c;
            }
            img {
                max-width: 100%;
                height: auto;
            }
            .material-symbols-outlined {
                font-family: 'Material Symbols Outlined';
                font-weight: normal;
                font-style: normal;
                font-size: 24px;
                line-height: 1;
                letter-spacing: normal;
                text-transform: none;
                display: inline-block;
                white-space: nowrap;
                word-wrap: normal;
                direction: ltr;
                font-variation-settings: 'FILL' 0, 'wght' 400, 'GRAD' 0, 'opsz' 24;
            }
            #webcrumbs .absolute { position: absolute; }
            #webcrumbs .relative { position: relative; }
            #webcrumbs .right-0 { right: 0; }
            #webcrumbs .z-10 { z-index: 10; }
            #webcrumbs .mx-auto { margin-left: auto; margin-right: auto; }
            #webcrumbs .mb-1 { margin-bottom: 4px; }
            #webcrumbs .mb-10 { margin-bottom: 40px; }
            #webcrumbs .mb-2 { margin-bottom: 8px; }
            #webcrumbs .mb-4 { margin-bottom: 16px; }
            #webcrumbs .mb-6 { margin-bottom: 24px; }
            #webcrumbs .mb-7 { margin-bottom: 28px; }
            #webcrumbs .mb-8 { margin-bottom: 32px; }
            #webcrumbs .ml-1 { margin-left: 4px; }
            #webcrumbs .ml-2 { margin-left: 8px; }
            #webcrumbs .mr-1 { margin-right: 4px; }
            #webcrumbs .mr-2 { margin-right: 8px; }
            #webcrumbs .mt-2 { margin-top: 8px; }
            #webcrumbs .mt-6 { margin-top: 24px; }
            #webcrumbs .mt-8 { margin-top: 32px; }
            #webcrumbs .mt-20 { margin-top: 80px; }
            #webcrumbs .block { display: block; }
            #webcrumbs .flex { display: flex; }
            #webcrumbs .grid { display: grid; }
            #webcrumbs .hidden { display: none; }
            #webcrumbs .h-14 { height: 56px; }
            #webcrumbs .h-4 { height: 16px; }
            #webcrumbs .h-6 { height: 24px; }
            #webcrumbs .h-64 { height: 256px; }
            #webcrumbs .h-8 { height: 32px; }
            #webcrumbs .h-full { height: 100%; }
            #webcrumbs .min-h-\[80vh\] { min-height: 80vh; }
            #webcrumbs .w-14 { width: 56px; }
            #webcrumbs .w-4 { width: 16px; }
            #webcrumbs .w-6 { width: 24px; }
            #webcrumbs .w-8 { width: 32px; }
            #webcrumbs .w-40 { width: 160px; }
            #webcrumbs .w-full { width: 100%; }
            #webcrumbs .max-w-\[1200px\] { max-width: 1200px; }
            #webcrumbs .max-w-2xl { max-width: 42rem; }
            #webcrumbs .max-w-3xl { max-width: 48rem; }
            #webcrumbs .max-w-4xl { max-width: 56rem; }
            #webcrumbs .max-w-5xl { max-width: 64rem; }
            #webcrumbs .max-w-md { max-width: 28rem; }
            #webcrumbs .transform {
                transform: translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate))
                    skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));
            }
            #webcrumbs .cursor-pointer { cursor: pointer; }
            #webcrumbs .list-none { list-style-type: none; }
            #webcrumbs .grid-cols-1 { grid-template-columns: repeat(1, minmax(0, 1fr)); }
            #webcrumbs .flex-row { flex-direction: row; }
            #webcrumbs .flex-col { flex-direction: column; }
            #webcrumbs .items-center { align-items: center; }
            #webcrumbs .justify-center { justify-content: center; }
            #webcrumbs .justify-between { justify-content: space-between; }
            #webcrumbs .gap-4 { gap: 16px; }
            #webcrumbs .gap-8 { gap: 32px; }
            #webcrumbs :is(.space-x-4 > :not([hidden]) ~ :not([hidden])) {
                --tw-space-x-reverse: 0;
                margin-left: calc(16px * (1 - var(--tw-space-x-reverse)));
                margin-right: calc(16px * var(--tw-space-x-reverse));
            }
            #webcrumbs :is(.space-x-6 > :not([hidden]) ~ :not([hidden])) {
                --tw-space-x-reverse: 0;
                margin-left: calc(24px * (1 - var(--tw-space-x-reverse)));
                margin-right: calc(24px * var(--tw-space-x-reverse));
            }
            #webcrumbs :is(.space-y-3 > :not([hidden]) ~ :not([hidden])) {
                --tw-space-y-reverse: 0;
                margin-bottom: calc(12px * var(--tw-space-y-reverse));
                margin-top: calc(12px * (1 - var(--tw-space-y-reverse)));
            }
            #webcrumbs :is(.space-y-6 > :not([hidden]) ~ :not([hidden])) {
                --tw-space-y-reverse: 0;
                margin-bottom: calc(24px * var(--tw-space-y-reverse));
                margin-top: calc(24px * (1 - var(--tw-space-y-reverse)));
            }
            #webcrumbs .overflow-hidden { overflow: hidden; }
            #webcrumbs .rounded { border-radius: 12px; }
            #webcrumbs .rounded-full { border-radius: 9999px; }
            #webcrumbs .rounded-lg { border-radius: 24px; }
            #webcrumbs .border { border-width: 1px; }
            #webcrumbs .border-b { border-bottom-width: 1px; }
            #webcrumbs .border-gray-100 { border-color: rgb(243 244 246); }
            #webcrumbs .border-gray-200 { border-color: rgb(229 231 235); }
            #webcrumbs .bg-gray-100 { background-color: rgb(243 244 246); }
            #webcrumbs .bg-gray-50 { background-color: rgb(249 250 251); }
            #webcrumbs .bg-gray-700 { background-color: rgb(55 65 81); }
            #webcrumbs .bg-white { background-color: rgb(255 255 255); }
            #webcrumbs .bg-gradient-to-b { background-image: linear-gradient(to bottom, var(--tw-gradient-stops)); }
            #webcrumbs .from-transparent { --tw-gradient-from: transparent; --tw-gradient-stops: var(--tw-gradient-from), var(--tw-gradient-to); }
            #webcrumbs .to-gray-900\/50 { --tw-gradient-to: rgba(17, 24, 39, 0.5); }
            #webcrumbs .object-cover { object-fit: cover; }
            #webcrumbs .p-2 { padding: 8px; }
            #webcrumbs .p-4 { padding: 16px; }
            #webcrumbs .p-6 { padding: 24px; }
            #webcrumbs .px-4 { padding-left: 16px; padding-right: 16px; }
            #webcrumbs .px-6 { padding-left: 24px; padding-right: 24px; }
            #webcrumbs .py-1 { padding-bottom: 4px; padding-top: 4px; }
            #webcrumbs .py-2 { padding-bottom: 8px; padding-top: 8px; }
            #webcrumbs .py-3 { padding-bottom: 12px; padding-top: 12px; }
            #webcrumbs .py-4 { padding-bottom: 16px; padding-top: 16px; }
            #webcrumbs .pt-0 { padding-top: 0; }
            #webcrumbs .text-center { text-align: center; }
            #webcrumbs .font-sans { font-family: 'Noto Serif TC', 'Source Han Serif TC', 'Songti TC', serif; }
            #webcrumbs .text-2xl { font-size: 24px; line-height: 31.2px; }
            #webcrumbs .text-4xl { font-size: 36px; line-height: 41.4px; }
            #webcrumbs .text-lg { font-size: 18px; line-height: 27px; }
            #webcrumbs .text-sm { font-size: 14px; line-height: 21px; }
            #webcrumbs .text-xl { font-size: 20px; line-height: 28px; }
            #webcrumbs .font-bold { font-weight: 700; }
            #webcrumbs .font-medium { font-weight: 500; }
            #webcrumbs .text-gray-600 { color: rgb(75 85 99); }
            #webcrumbs .text-gray-700 { color: rgb(55 65 81); }
            #webcrumbs .text-gray-800 { color: rgb(31 41 55); }
            #webcrumbs .text-white { color: rgb(255 255 255); }
            #webcrumbs .text-red-600 { color: rgb(220 38 38); }
            #webcrumbs .text-green-600 { color: rgb(22 163 74); }
            #webcrumbs .text-yellow-600 { color: rgb(202 138 4); }
            #webcrumbs .shadow-sm { box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05); }
            #webcrumbs .transition-all { transition-duration: 0.15s; transition-property: all; }
            #webcrumbs .transition-colors { transition-duration: 0.15s; transition-property: color, background-color, border-color; }
            #webcrumbs .transition-transform { transition-duration: 0.15s; transition-property: transform; }
            #webcrumbs .duration-200 { transition-duration: 0.2s; }
            #webcrumbs .duration-300 { transition-duration: 0.3s; }
            #webcrumbs .duration-500 { transition-duration: 0.5s; }
            #webcrumbs .hover\:scale-105:hover { --tw-scale-x: 1.05; --tw-scale-y: 1.05; }
            #webcrumbs .hover\:scale-\[1.02\]:hover { --tw-scale-x: 1.02; --tw-scale-y: 1.02; }
            #webcrumbs .hover\:border-gray-400:hover { border-color: rgb(156 163 175); }
            #webcrumbs .hover\:bg-gray-50:hover { background-color: rgb(249 250 251); }
            #webcrumbs .hover\:bg-gray-800:hover { background-color: rgb(31 41 55); }
            #webcrumbs .hover\:text-gray-700:hover { color: rgb(55 65 81); }
            #webcrumbs .hover\:underline:hover { text-decoration: underline; }
            #webcrumbs .focus\:outline-none:focus { outline: 2px solid transparent; }
            #webcrumbs .focus\:ring-1:focus { box-shadow: 0 0 0 1px rgb(156 163 175); }
            #webcrumbs .focus\:ring-gray-400:focus { --tw-ring-color: rgb(156 163 175); }
            #webcrumbs a {
                text-decoration: none;
            }
            #webcrumbs a:hover,
            #webcrumbs a:focus,
            #webcrumbs a:active {
                text-decoration: none;
            }
            
            .upload-section {
                border: 2px dashed rgba(210, 200, 190, 0.75);
                border-radius: 16px;
                padding: 24px;
                text-align: center;
                cursor: pointer;
                background-color: rgba(253, 251, 248, 0.6);
                transition: all 0.3s ease;
            }
            
            .upload-section:hover {
                border-color: rgba(180, 160, 145, 0.85);
                background-color: rgba(253, 251, 248, 0.9);
            }
            
            .upload-section.drag-over {
                border-color: rgba(150, 130, 115, 0.9);
                background-color: rgba(246, 245, 243, 0.95);
            }

            
            .invalid-report-card {
                background-color: #fdfbf8;
                border: 1px solid rgba(210, 200, 190, 0.7);
                border-radius: 20px;
                padding: 24px 28px;
                margin-bottom: 24px;
                box-shadow: 0 8px 20px rgba(110, 83, 63, 0.08);
                text-align: center;
            }

            .invalid-report-title {
                margin: 0 0 8px;
                font-size: 1.15rem;
                font-weight: 600;
                color: #3c2f26;
            }

            .invalid-report-body {
                margin: 0 0 12px;
                font-size: 0.95rem;
                line-height: 1.7;
                color: #6f5e52;
            }

            .invalid-report-note {
                margin: 0 0 18px;
                font-size: 0.85rem;
                color: #7a6a5c;
            }

            .invalid-report-actions {
                display: flex;
                justify-content: center;
                gap: 12px;
                margin-top: 0;
                flex-wrap: wrap;
            }

            .btn-invalid-primary, .btn-invalid-secondary {
                padding: 10px 18px;
                border-radius: 999px;
                font-weight: 600;
                font-size: 0.95rem;
                transition: all 0.2s ease;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                text-decoration: none;
            }

            .btn-invalid-primary {
                background: linear-gradient(135deg, #f4d7c3 0%, #e8c3ad 100%);
                color: #5b4032;
                border: 1px solid rgba(205, 175, 154, 0.75);
                box-shadow: 0 6px 14px rgba(112, 83, 63, 0.15);
            }

            .btn-invalid-primary:hover {
                background: linear-gradient(135deg, #ebcdb7 0%, #dfb49a 100%);
            }

            .btn-invalid-secondary {
                background-color: transparent;
                color: #6a5648;
                border: 1px solid rgba(205, 175, 154, 0.65);
            }

            .btn-invalid-secondary:hover {
                border-color: rgba(180, 160, 145, 0.9);
                color: #4f3a2f;
            }

            .button-reupload {
                display: inline-flex;
                align-items: center;
                gap: 12px;
                padding: 12px 20px;
                border-radius: 999px;
                background-color: #ffffff;
                color: #374151;
                font-size: 16px;
                font-weight: 600;
                border: 1px solid rgba(17, 24, 39, 0.08);
                box-shadow: 0 4px 12px rgba(15, 23, 42, 0.08);
                transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
                white-space: nowrap;
            }

            .button-reupload:hover {
                transform: translateY(-1px);
                box-shadow: 0 8px 20px rgba(15, 23, 42, 0.12);
                border-color: rgba(17, 24, 39, 0.15);
            }

            .button-reupload:focus {
                outline: none;
                box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.25);
            }

            .button-reupload .paw-icon {
                font-size: 20px;
            }

            .button-reupload .upload-icon {
                font-size: 22px;
            }

            .button-reupload .button-text {
                letter-spacing: 0.02em;
            }

            .loading-overlay {
                position: fixed;
                inset: 0;
                background: rgba(44, 35, 28, 0.45);
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 24px;
                backdrop-filter: blur(6px);
                z-index: 999;
            }

            .loading-overlay.hidden {
                display: none !important;
            }

            .loading-card {
                background: #fdfbf8;
                border-radius: 20px;
                padding: 48px 40px;
                text-align: center;
                border: 1px solid rgba(215, 196, 182, 0.5);
                box-shadow: 0 20px 50px rgba(60, 45, 35, 0.2);
            }

            .dots-loader {
                display: flex;
                gap: 12px;
                justify-content: center;
                margin-bottom: 24px;
            }

            .dot {
                width: 16px;
                height: 16px;
                border-radius: 50%;
                animation: bounce 1.4s ease-in-out infinite;
            }

            .dot:nth-child(1) {
                background: linear-gradient(135deg, #ec4899, #f472b6);
                animation-delay: 0s;
            }

            .dot:nth-child(2) {
                background: linear-gradient(135deg, #8b5cf6, #a78bfa);
                animation-delay: 0.2s;
            }

            .dot:nth-child(3) {
                background: linear-gradient(135deg, #3b82f6, #60a5fa);
                animation-delay: 0.4s;
            }

            @keyframes bounce {
                0%, 80%, 100% {
                    transform: scale(1) translateY(0);
                    opacity: 0.7;
                }
                40% {
                    transform: scale(1.3) translateY(-20px);
                    opacity: 1;
                }
            }

            .loading-text {
                font-size: 18px;
                color: #374151;
                font-weight: 500;
                line-height: 1.6;
            }

            .file-input {
                display: none;
            }

            #webcrumbs .warm-cta:disabled {
                opacity: 0.55;
                cursor: not-allowed;
                box-shadow: none;
            }

            .upload-reminder {
                margin: 0;
                font-size: 0.85rem;
                line-height: 1.6;
                color: #7a6a5c;
                text-align: center;
            }
            
            .upload-buttons {
                display: flex;
                gap: 12px;
                justify-content: center;
                margin-top: 16px;
                flex-wrap: wrap;
            }
            
            .btn-upload {
                display: inline-flex;
                align-items: center;
                gap: 6px;
                padding: 8px 18px;
                border: 1px solid rgba(205, 175, 154, 0.65);
                border-radius: 999px;
                background-color: transparent;
                color: #5b4032;
                cursor: pointer;
                transition: all 0.2s ease;
                font-size: 14px;
                font-weight: 600;
            }
            
            .btn-upload-primary {
                background: linear-gradient(135deg, #f4d7c3 0%, #e8c3ad 100%);
                border-color: rgba(205, 175, 154, 0.75);
            }

            .btn-upload-secondary {
                background-color: rgba(253, 251, 248, 0.9);
                color: #6a5648;
            }
            
            .btn-upload:hover {
                border-color: rgba(180, 160, 145, 0.9);
            }

            .btn-upload-primary:hover {
                background: linear-gradient(135deg, #ebcdb7 0%, #dfb49a 100%);
            }

            .btn-upload-secondary:hover {
                background-color: rgba(253, 251, 248, 1);
            }
            
            .file-info {
                margin-top: 16px;
                padding: 12px;
                background-color: #f3f4f6;
                border-radius: 8px;
                display: none;
            }
            
            @media (max-width: 640px) {
                #webcrumbs .sm\:p-4 { padding: 16px; }
                #webcrumbs .sm\:px-2 { padding-left: 8px; padding-right: 8px; }
                #webcrumbs .sm\:text-3xl { font-size: 30px; line-height: 36px; }
                #webcrumbs .sm\:text-lg { font-size: 16px; line-height: 24px; }
                #webcrumbs .sm\:h-48 { height: 192px; }
                #webcrumbs .sm\:gap-4 { gap: 16px; }
                #webcrumbs .sm\:max-w-full { max-width: 100%; }
                
                .upload-buttons {
                    flex-direction: column;
                    align-items: center;
                }
                
                .btn-upload {
                    width: 100%;
                    justify-content: center;
                    max-width: 200px;
                }
            }
            @media (min-width: 768px) {
                #webcrumbs .md\:flex { display: flex; }
                #webcrumbs .md\:grid-cols-3 { grid-template-columns: repeat(3, minmax(0, 1fr)); }
                #webcrumbs .md\:text-5xl { font-size: 48px; line-height: 52.8px; }
            }
            @media (max-width: 1024px) {
                #webcrumbs .lg\:max-w-4xl { max-width: 56rem; }
                #webcrumbs .lg\:max-w-3xl { max-width: 48rem; }
            }
        </style>
        <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" />
        <link rel="apple-touch-icon" sizes="192x192" href="https://cdn.webcrumbs.org/assets/images/landing/logo192.png" />
        <link rel="apple-touch-icon" sizes="512x512" href="https://cdn.webcrumbs.org/assets/images/landing/logo512.png" />
        <meta name="theme-color" content="#ffffff" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="default" />
        <meta name="apple-mobile-web-app-title" content="Meow Yourself" />
    </head>
    <body>
        
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K2VQTGFM"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        

        <div id="webcrumbs">
            <div class="max-w-[1200px] w-full font-sans mx-auto warm-shell">
                <header class="py-4 px-6 sm:px-2 flex justify-between items-center warm-shell warm-divider">
                    <div class="flex flex-col items-center gap-2" style="width: max-content; min-width: calc(0.96rem + 1.6cm + 56px);">
                        <a href="{{ url_for('home') }}" class="flex items-center">
                            <img src="{{ url_for('static', filename='banner_white.png') }}" alt="Meow Yourself Logo" style="height: calc(0.96rem + 1.6cm); width: auto;" /> 
                        </a>
                        <span
                            class="text-gray-600 font-medium text-center"
                            style="display: block; width: 100%; font-size: 1rem; letter-spacing: 0.18em; white-space: nowrap;"
                            >AI陪你讀懂身心</span
                        >
                    </div>
                    <nav class="hidden md:flex space-x-6">
                        <a href="{{ url_for('home') }}" class="hover:text-gray-700 transition-colors duration-200 flex items-center">
                            <span class="material-symbols-outlined mr-1">home</span> 首頁
                        </a>
                    </nav>
                    <div class="flex items-center">
                        <details class="relative">
                            <summary class="list-none flex items-center cursor-pointer">
                                <img src="{{ url_for('static', filename=user_avatar) }}" class="h-8 w-8 rounded-full border border-gray-200 hover:border-gray-400 transition-all duration-200 object-cover" alt="Profile" />
                            </summary>
                            <div id="profile-menu" class="absolute right-0 mt-2 w-40 rounded shadow-sm py-1 z-10 border border-gray-100 warm-surface warm-menu">
                                {% if is_logged_in %}
                                <div class="px-4 py-3 border-b border-gray-100">
                                    <p class="text-xs text-gray-500 mb-1">目前積分</p>
                                    <p class="text-lg font-semibold text-amber-500">{{ user_points }}</p>
                                </div>
                                <a href="{{ url_for('profile') }}" class="block px-4 py-2 text-sm transition-colors duration-200 warm-menu-link">
                                    我的檔案
                                </a>
                                <div class="border-t border-gray-100 my-1"></div>
                                <a href="{{ url_for('delete_account') }}" class="block px-4 py-2 text-sm transition-colors duration-200 warm-menu-link text-red-600">刪除帳號</a>
                                <a href="{{ url_for('logout') }}" class="block px-4 py-2 text-sm transition-colors duration-200 warm-menu-link">登出</a>
                                {% else %}
                                <a href="{{ url_for('login') }}" class="block px-4 py-2 text-sm transition-colors duration-200 warm-menu-link">登入</a>
                                {% endif %}
                            </div>
                        </details>
                    </div>
                </header>
                <main class="p-6 sm:p-4">
                    <div class="flex flex-col items-center justify-center {% if auto_redirect %}min-h-[60vh]{% else %}min-h-[80vh]{% endif %} max-w-4xl sm:max-w-full mx-auto">
                        <h1 class="text-3xl sm:text-2xl md:text-4xl font-bold mb-4 text-center">上傳健康報告</h1>
                        <p class="text-lg sm:text-base text-gray-600 mb-6 text-center max-w-2xl sm:max-w-full">
                            支援 PDF、JPG、PNG 格式，檔案大小上限 10MB
                        </p>
                        
                        
                        {% if auto_redirect %}
                        <div class="w-full max-w-3xl sm:max-w-full mb-8">
                            <div class="status-card">
                                <p class="status-title">已找到您最近一次的健檢報告</p>
                                <p class="status-subtitle">系統將以此作為後續心理測驗的參考摘要</p>
                                <a href="{{ url_for('upload_health', reupload=1) }}" class="button-reupload">
                                    <span class="button-text">我想重新上傳報告</span>
                                </a>
                            </div>
                            <p class="status-disclaimer">非醫療服務｜僅作參考，無法取代專業建議</p>
                        </div>
                        <script>
                            setTimeout(function () {
                                window.location.href = {{ psychology_url|tojson }};
                            }, 2500);
                        </script>
                        {% endif %}
                        {% if force_reupload %}
                        
                        <div class="w-full max-w-3xl sm:max-w-full mb-8">
                            <div class="warm-surface warm-border text-gray-700 rounded-xl px-5 py-3 text-sm text-center">
                                您選擇重新上傳健檢報告，提交後將覆蓋最新紀錄。
                            </div>
                        </div>
                        {% endif %}
                        {% if not auto_redirect %}
                        {% set flashed_messages = get_flashed_messages(with_categories=true) %}
                        {% set msg_ns = namespace(invalid_message=None, general=[]) %}
                        {% for category, message in flashed_messages %}
                            {% if category == 'invalid_report' %}
                                {% set msg_ns.invalid_message = message %}
                            {% else %}
                                {% set _ = msg_ns.general.append((category, message)) %}
                            {% endif %}
                        {% endfor %}
                        {% if invalid_report_prompt %}
                        
                        <div class="invalid-report-card" role="status">
                            <p class="invalid-report-title">未辨識為健檢報告</p>
                            <p class="invalid-report-body">系統已完成檔案掃描，但內容未符合健檢報告的判定條件，<br>因此無法作為後續分析的參考。</p>
                            <p class="invalid-report-note">此檔案不會被儲存或使用，請放心。</p>
                            <div class="invalid-report-actions">
                                <a class="btn-invalid-primary" href="{{ url_for('upload_health', reupload=1) }}">重新上傳健檢報告</a>
                                <a class="btn-invalid-secondary" href="{{ url_for('psychology_test') }}">使用既有報告繼續</a>
                            </div>
                        </div>
                        {% endif %}
                        <form id="health-upload-form" method="POST" action="{{ url_for('upload_health') }}" enctype="multipart/form-data" class="space-y-6 max-w-md w-full sm:max-w-full">
                            <div class="warm-surface upload-card rounded-lg shadow-sm p-6">
                                {% if error %}
                                <p class="text-sm text-red-600 mb-4 text-center">{{ error }}</p>
                                {% endif %}
                                {% for category, message in msg_ns.general %}
                                <p class="text-sm {% if category == 'error' %}text-red-600{% elif category == 'warning' %}text-yellow-600{% else %}text-green-600{% endif %} mb-4 text-center">{{ message }}</p>
                                {% endfor %}
                                <div>
                                    <label class="block text-sm font-medium mb-2 text-center">選擇檔案上傳</label>
                                    <div class="upload-section" onclick="triggerFileInput()">
                                        <div class="mb-4">
                                            <span class="material-symbols-outlined text-gray-400" style="font-size: 48px;">upload_file</span>
                                        </div>
                                        <p class="text-sm text-gray-600 mb-2">點擊此處或將檔案拖曳到這裡</p>
                                        <div class="upload-buttons">
                                            <button type="button" class="btn-upload btn-upload-primary" onclick="event.stopPropagation(); triggerFileInput()">
                                                <span class="material-symbols-outlined">folder_open</span>
                                                選擇檔案
                                            </button>
                                            <button type="button" class="btn-upload btn-upload-secondary" onclick="event.stopPropagation(); triggerCameraInput()">
                                                <span class="material-symbols-outlined">photo_camera</span>
                                                拍照
                                            </button>
                                        </div>
                                    </div>
                                    <input type="file" id="health_report" name="health_report" accept="image/jpeg,image/png,application/pdf" class="file-input" onchange="showFileInfo(this)">
                                    <input type="file" id="camera_input" accept="image/jpeg,image/png" capture="camera" class="file-input" onchange="syncCameraFile(this)">
                                    <div id="file-info" class="file-info">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <span class="material-symbols-outlined text-green-600 mr-2">check_circle</span>
                                                <span id="file-name" class="text-sm font-medium"></span>
                                            </div>
                                            <span id="file-size" class="text-xs text-gray-500"></span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <p class="upload-reminder">上傳前請先遮住個人識別資訊（如姓名、證號、病歷號碼），<br>以確保你的隱私安全。</p>
                            <button id="submit-upload" type="submit" class="w-full py-3 px-4 rounded warm-cta transition-colors duration-300" disabled>
                                確認上傳
                            </button>
                        </form>
                        {% endif %}
                    </div>
                </main>
            </div>
        </div>

        <div id="upload-loading" class="loading-overlay hidden" aria-live="assertive">
            <div class="loading-card">
                <div class="dots-loader">
                    <div class="dot"></div>
                    <div class="dot"></div>
                    <div class="dot"></div>
                </div>
                <p id="loading-message" class="loading-text">
                    報告上傳中，請稍後...
                </p>
            </div>
        </div>

        <script>
            // 檔案拖拽功能
            const uploadSection = document.querySelector('.upload-section');
            if (uploadSection) {
                uploadSection.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadSection.classList.add('drag-over');
                });

                uploadSection.addEventListener('dragleave', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('drag-over');
                });

                uploadSection.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadSection.classList.remove('drag-over');

                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        const mainInput = document.getElementById('health_report');
                        mainInput.files = files;
                        showFileInfo(mainInput);
                    }
                });
            }
            
            function triggerFileInput() {
                document.getElementById('health_report').click();
            }
            
            function triggerCameraInput() {
                document.getElementById('camera_input').click();
            }
            
            function syncCameraFile(cameraInput) {
                if (cameraInput.files && cameraInput.files[0]) {
                    const mainInput = document.getElementById('health_report');
                    
                    const dt = new DataTransfer();
                    dt.items.add(cameraInput.files[0]);
                    mainInput.files = dt.files;
                    
                    showFileInfo(mainInput);
                }
            }

            function showFileInfo(input) {
                const fileInfo = document.getElementById('file-info');
                const fileName = document.getElementById('file-name');
                const fileSize = document.getElementById('file-size');
                const submitButton = document.getElementById('submit-upload');
                
                if (input.files && input.files[0]) {
                    const file = input.files[0];
                    const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
                    
                    fileName.textContent = file.name;
                    fileSize.textContent = `${sizeInMB} MB`;
                    fileInfo.style.display = 'block';
                    
                    if (file.size > 10 * 1024 * 1024) {
                        fileInfo.style.backgroundColor = '#fee2e2';
                        fileName.style.color = '#dc2626';
                        fileSize.style.color = '#dc2626';
                        fileSize.textContent += ' (超過限制)';
                        if (submitButton) {
                            submitButton.disabled = true;
                        }
                    } else {
                        fileInfo.style.backgroundColor = '#f0fdf4';
                        fileName.style.color = '#166534';
                        fileSize.style.color = '#6b7280';
                        if (submitButton) {
                            submitButton.disabled = false;
                        }
                    }
                } else {
                    fileInfo.style.display = 'none';
                    if (submitButton) {
                        submitButton.disabled = true;
                    }
                }
            }

            const loadingOverlay = document.getElementById('upload-loading');
            const loadingMessage = document.getElementById('loading-message');

            function showLoading(message) {
                if (message) {
                    loadingMessage.innerHTML = message;
                }
                loadingOverlay.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            function hideLoading() {
                loadingOverlay.classList.add('hidden');
                document.body.style.overflow = '';
            }

            const uploadForm = document.getElementById('health-upload-form');
            if (uploadForm) {
                uploadForm.addEventListener('submit', (e) => {
                    const fileInput = document.getElementById('health_report');
                    if (!fileInput.files || fileInput.files.length === 0) {
                        e.preventDefault();
                        alert('請先選擇要上傳的檔案！');
                        return false;
                    }
                    
                    const file = fileInput.files[0];
                    if (file.size > 10 * 1024 * 1024) {
                        e.preventDefault();
                        alert('檔案大小超過 10MB 限制！');
                        return false;
                    }
                    
                    showLoading('報告上傳中，請稍候...');
                });
            }

            window.addEventListener('load', () => {
                hideLoading();
            });
        </script>
    </body>
</html>
