<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        
        <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','GTM-K2VQTGFM');</script>
        
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-K2VQTGFM');</script>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>我的檔案 - Meow Yourself</title>
        <style>
            @import url(https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;500;700&display=swap);
            @import url(https://fonts.googleapis.com/css2?family=Lato&display=swap);
            @import url(https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200);
            *, :after, :before {
                border: 0 solid #e5e7eb;
                box-sizing: border-box;
            }
            body {
                margin: 0;
                font-family: "Lato", "PingFang TC", "Microsoft JhengHei", sans-serif;
                background: linear-gradient(160deg, #f1e7e0 0%, #e7d2c5 45%, #f8f1eb 100%);
                color: #4b2b1f;
            }
            a {
                text-decoration: none;
            }
            #webcrumbs .warm-shell {
                background: linear-gradient(180deg, #f9f0e9 0%, #f1e7e0 55%, #e7d4c6 100%);
            }
            .page-shell {
                max-width: 1200px;
                width: 100%;
                margin: 0 auto;
                padding: 0 1.25rem 3rem;
            }
            .app-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                gap: 1rem;
                padding: 1.5rem 0;
                flex-wrap: wrap;
                color: #5c2f80;
                font-weight: 600;
            }
            .header-actions {
                display: flex;
                align-items: center;
                gap: 1rem;
            }
            .main-nav {
                display: flex;
                align-items: center;
                gap: 1.5rem;
            }
            .main-nav a {
                color: #5c2f80;
                font-weight: 600;
                display: inline-flex;
                align-items: center;
                gap: 0.4rem;
            }
            .nav-toggle {
                display: none;
                background: rgba(255, 255, 255, 0.8);
                border: 1px solid rgba(92, 47, 128, 0.2);
                border-radius: 999px;
                padding: 0.35rem 0.65rem;
                color: #5c2f80;
                cursor: pointer;
            }
            details summary::-webkit-details-marker,
            details summary::marker {
                display: none;
            }
            .profile-card {
                width: 100%;
                background: rgba(255, 255, 255, 0.95);
                border-radius: 1.5rem;
                padding: 2.5rem;
                box-shadow: 0 20px 50px rgba(212, 182, 163, 0.45);
            }
            .intro-text,
            .points-summary {
                font-size: 1rem;
                color: #6c4f3f;
            }
            .points-summary {
                display: flex;
                flex-direction: column;
                gap: 0.4rem;
                margin-bottom: 2rem;
            }
            .points-summary .label {
                letter-spacing: 0.05em;
            }
            .points-summary .value {
                font-weight: 600;
                color: #4b2b1f;
                margin-left: 0.35rem;
            }
            .progress-visual {
                margin-top: 1rem;
            }
            .progress-track {
                width: 100%;
                height: 12px;
                background: rgba(248, 225, 200, 0.7);
                border-radius: 999px;
                overflow: hidden;
                position: relative;
            }
            .progress-fill {
                height: 100%;
                background: linear-gradient(120deg, #f0b795, #fbd499);
                border-radius: 999px;
                transition: width 0.3s ease;
            }
            .progress-labels {
                display: flex;
                justify-content: space-between;
                font-size: 0.85rem;
                color: #8c6a5a;
                margin-top: 0.4rem;
            }
            .avatar-grid {
                margin-top: 1.25rem;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 1rem;
            }
            .avatar-option {
                border: 1px solid rgba(226, 202, 187, 0.8);
                border-radius: 1rem;
                padding: 0.75rem;
                text-align: center;
                background: #fffdf8;
                transition: border 0.2s ease, box-shadow 0.2s ease, transform 0.2s ease;
                cursor: pointer;
                position: relative;
            }
            .avatar-option.selected {
                border: 3px solid #f0b795;
                box-shadow: 0 10px 25px rgba(240, 183, 149, 0.35);
                transform: translateY(-2px);
            }
            .avatar-option input {
                display: none;
            }
            .avatar-option img {
                width: 100%;
                max-width: 172px;
                height: auto;
                aspect-ratio: 1 / 1;
                border-radius: 999px;
                object-fit: cover;
                border: 1px solid rgba(161, 130, 110, 0.35);
                background: #fff;
                padding: 0.3rem;
            }
            .avatar-option .checkmark {
                position: absolute;
                top: 0.6rem;
                right: 0.6rem;
                width: 24px;
                height: 24px;
                border-radius: 999px;
                background: #f0b795;
                color: white;
                display: none;
                align-items: center;
                justify-content: center;
                font-size: 1rem;
                box-shadow: 0 4px 8px rgba(240, 183, 149, 0.4);
            }
            .avatar-option.selected .checkmark {
                display: flex;
            }
            .section-title {
                font-size: 1.25rem;
                font-weight: 600;
                color: #4b2b1f;
                margin: 2rem 0 0.5rem;
            }
            .badge-grid {
                margin-top: 1.25rem;
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
                gap: 1.25rem;
            }
            .badge-card {
                border: 1px solid rgba(221, 199, 184, 0.7);
                border-radius: 1rem;
                padding: 1rem;
                background: #ffffff;
                text-align: center;
                box-shadow: 0 10px 25px rgba(236, 205, 189, 0.25);
                position: relative;
                overflow: hidden;
            }
            .badge-card img {
                width: 150px;
                height: 150px;
                object-fit: contain;
                margin-bottom: 0.6rem;
            }
            .badge-card.unlocked {
                animation: glowPulse 2s ease-in-out infinite;
                box-shadow: 0 12px 30px rgba(249, 211, 150, 0.5);
            }
            .badge-card.locked {
                opacity: 0.5;
                filter: none;
                border-style: dashed;
                background: rgba(255, 255, 255, 0.65);
            }
            .badge-card.locked .lock-icon {
                position: absolute;
                top: 0.75rem;
                right: 0.75rem;
                width: 28px;
                height: 28px;
                border-radius: 999px;
                background: rgba(153, 133, 118, 0.85);
                color: white;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 1rem;
                box-shadow: 0 4px 10px rgba(153, 133, 118, 0.35);
            }
            .badge-card.next-target {
                border: 2px solid rgba(249, 211, 150, 0.8);
                background: linear-gradient(180deg, rgba(249, 211, 150, 0.18), rgba(255, 255, 255, 1));
            }
            .actions-row {
                margin-top: 2.5rem;
                display: flex;
                justify-content: center;
                gap: 1rem;
                flex-wrap: wrap;
            }
            .btn-primary {
                border: 1px solid rgba(203, 164, 140, 0.6);
                border-radius: 999px;
                padding: 0.85rem 1.8rem;
                background: linear-gradient(120deg, #f6c7a8 0%, #f0b796 100%);
                color: #4b2b1f;
                font-weight: 600;
                display: inline-flex;
                align-items: center;
                gap: 0.4rem;
                transition: transform 0.2s ease, box-shadow 0.2s ease;
            }
            .btn-primary:hover {
                transform: translateY(-2px);
                box-shadow: 0 12px 24px rgba(244, 189, 152, 0.35);
            }
            @keyframes glowPulse {
                0% {
                    box-shadow: 0 10px 25px rgba(249, 211, 150, 0.4);
                }
                50% {
                    box-shadow: 0 12px 36px rgba(249, 211, 150, 0.9);
                }
                100% {
                    box-shadow: 0 10px 25px rgba(249, 211, 150, 0.4);
                }
            }
            .avatar-actions {
                margin-top: 1.5rem;
                display: flex;
                justify-content: center;
            }
            .section-divider {
                margin: 2.5rem auto 2rem;
                border: none;
                height: 1px;
                background: rgba(203, 164, 140, 0.35);
                width: 100%;
                max-width: 900px;
            }
            .flash {
                margin-top: 1rem;
                padding: 0.75rem 1rem;
                border-radius: 0.75rem;
                font-size: 0.95rem;
            }
            .flash.success {
                background: rgba(197, 243, 203, 0.7);
                color: #1d6b2d;
            }
            .flash.error {
                background: rgba(254, 215, 215, 0.9);
                color: #a62626;
            }
            .profile-controls {
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }
            .simple-profile-avatar {
                width: 3rem;
                height: 3rem;
                border-radius: 999px;
                object-fit: cover;
                border: 1px solid rgba(164, 145, 211, 0.35);
                box-shadow: 0 4px 12px rgba(164, 145, 211, 0.2);
            }
            details.profile-actions {
                position: relative;
                display: inline-flex;
                align-items: center;
            }
            details.profile-actions summary {
                list-style: none;
                display: inline-flex;
                cursor: pointer;
            }
            .profile-trigger {
                list-style: none;
                border: 2px solid rgba(251, 191, 36, 0.5);
                border-radius: 999px;
                display: inline-flex;
                width: 4.2rem;
                height: 4.2rem;
                align-items: center;
                justify-content: center;
                background: #fffaf4;
                box-shadow: 0 6px 18px rgba(251, 191, 36, 0.25);
                cursor: pointer;
            }
            .profile-trigger img {
                width: 3.6rem;
                height: 3.6rem;
                border-radius: 999px;
                object-fit: cover;
            }
            .profile-trigger .guest-avatar {
                width: 3.2rem;
                height: 3.2rem;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                border-radius: 999px;
                background: radial-gradient(circle, #fffdfa 0%, #f6ddc9 100%);
                color: #8c6a5a;
                font-size: 1.6rem;
                font-weight: 600;
            }
            .profile-menu-links a {
                display: block;
            }
            @media (max-width: 900px) {
                .nav-toggle {
                    display: inline-flex;
                    align-items: center;
                    justify-content: center;
                }
                .main-nav {
                    display: none;
                    flex-direction: column;
                    gap: 0.75rem;
                    width: 100%;
                    padding: 0.75rem 0;
                }
                .main-nav.open {
                    display: flex;
                }
                .app-header {
                    align-items: flex-start;
                }
                .header-actions {
                    width: 100%;
                    justify-content: flex-start;
                    order: 3;
                }
                .profile-controls {
                    order: 2;
                    align-self: flex-end;
                    margin-top: 0.5rem;
                }
            }
            @media (max-width: 600px) {
                .page-shell {
                    padding: 0 1rem 2rem;
                }
                .profile-card {
                    padding: 1.75rem;
                }
                .avatar-grid {
                    grid-template-columns: repeat(2, minmax(0, 1fr));
                }
                .avatar-option img {
                    max-width: 140px;
                }
            }
        
        body {
            font-family: 'Noto Serif TC', 'Source Han Serif TC', 'Songti TC', serif;
            font-size: 16px;
            line-height: 1.7;
            color: #2f2a25;
            background-color: #f6f5f3;
            background-image: linear-gradient(160deg, #f6f5f3 0%, #faf9f7 45%, #fdfbf8 100%);
        }
        #webcrumbs .warm-shell,
        .warm-shell {
            background: linear-gradient(180deg, #fdfbf8 0%, #f6f5f3 60%, #faf9f7 100%);
        }
        #webcrumbs .warm-surface,
        .warm-surface {
            background: linear-gradient(160deg, rgba(253, 251, 248, 0.95) 0%, rgba(246, 245, 243, 0.95) 100%);
        }

        #webcrumbs .warm-cta,
        #webcrumbs .warm-cta-main,
        .warm-cta,
        .warm-cta-main,
        .btn-primary,
        .cta-button,
        #brand-intro-enter-btn,
        #generate-card-button {
            background: linear-gradient(135deg, #f4d7c3 0%, #e8c3ad 100%);
            color: #5b4032;
            border: 1px solid rgba(205, 175, 154, 0.6);
        }
        #webcrumbs .warm-cta:hover,
        #webcrumbs .warm-cta-main:hover,
        .warm-cta:hover,
        .warm-cta-main:hover,
        .btn-primary:hover,
        .cta-button:hover,
        #brand-intro-enter-btn:hover,
        #generate-card-button:hover {
            background: linear-gradient(135deg, #ebcdb7 0%, #dfb49a 100%);
            color: #4b3326;
        }
        #webcrumbs .font-sans,
        .font-sans {
            font-family: 'Noto Serif TC', 'Source Han Serif TC', 'Songti TC', serif;
        }


        button,
        input[type="button"],
        input[type="submit"],
        input[type="reset"],
        [class*="btn"],
        [class*="button"],
        .warm-cta,
        .warm-cta-main,
        .warm-cta-outline {
            font-family: 'Noto Serif TC', 'Source Han Serif TC', 'Songti TC', serif;
            font-weight: 700;
        }
</style>
    </head>
    <body>
                
        <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K2VQTGFM"
        height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
        
        <div id="webcrumbs">
            <div class="page-shell warm-shell">
                <header class="app-header">
                    <div class="flex flex-col items-center gap-2" style="width: max-content; min-width: calc(0.96rem + 1.6cm + 56px);">
                        <a href="{{ url_for('home') }}" class="flex items-center">
                            <img src="{{ url_for('static', filename='banner_pink.png') }}" alt="Meow Yourself Logo" style="height: calc(0.96rem + 1.6cm); width: auto;" />
                        </a>
                        <span
                            class="text-gray-600 font-medium text-center"
                            style="display: block; width: 100%; font-size: 1rem; letter-spacing: 0.18em; white-space: nowrap;"
                            >AI陪你讀懂身心</span
                        >
                    </div>
                    <div class="header-actions">
                        <button id="profile-nav-toggle" class="nav-toggle" type="button" aria-label="切換選單">
                            <span class="material-symbols-outlined">menu</span>
                        </button>
                        <nav id="profile-nav-links" class="main-nav">
                            <a href="{{ url_for('home') }}"><span class="material-symbols-outlined">home</span> 首頁</a>
                            <a href="{{ url_for('featured_cats') }}"><span class="material-symbols-outlined">pets</span> 九宮格貓咪</a>
                        </nav>
                    </div>
                    <div class="profile-controls">
                        {% if is_logged_in %}
                        <img src="{{ url_for('static', filename=user_avatar) }}" alt="目前頭像" class="simple-profile-avatar" />
                        {% else %}
                        <span class="guest-avatar" aria-hidden="true">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.6" xmlns="http://www.w3.org/2000/svg" width="22" height="22">
                                <circle cx="12" cy="8" r="4"></circle>
                                <path d="M4 20c0-4 4-6 8-6s8 2 8 6"></path>
                            </svg>
                        </span>
                        {% endif %}
                    </div>
                </header>

                <main class="p-6 sm:p-4">
                    <div class="flex flex-col items-center justify-center w-full max-w-4xl mx-auto px-0 sm:px-4">
                        <form method="POST" class="avatar-form">
                                <div class="section-title">更換大頭貼</div>
                                <p class="text-sm text-gray-500">你好，{{ user_name }}！挑選一張你喜歡的吧！</p>
                                <div class="avatar-grid">
                                    {% for option in avatar_options %}
                                    <label class="avatar-option {{ 'selected' if option == current_avatar else '' }}">
                                        <input type="radio" name="avatar" value="{{ option }}" {% if option == current_avatar %}checked{% endif %} />
                                        <span class="checkmark">&#10003;</span>
                                        <img src="{{ url_for('static', filename=option) }}" alt="目前頭像 {{ loop.index }}" />
                                    </label>
                                    {% endfor %}
                                </div>
                                <div class="avatar-actions">
                                    <button type="submit" class="btn-primary">更換大頭貼</button>
                                </div>
                                <hr class="section-divider" />
                            </form>

                        <div class="profile-card">
                            <p class="intro-text">每次登入即可獲得 5 點，當日最高 5 點。累積足夠積分就能解鎖徽章！</p>

                            <div class="points-summary">
                                <p class="label">目前積分：<span class="value">{{ user_points }}</span></p>
                                {% if next_badge %}
                                <p class="hint">Next：{{ next_badge.name }}（還差 {{ points_to_next }} 點）</p>
                                {% else %}
                                <p class="hint">太棒了！你已解鎖所有徽章。</p>
                                {% endif %}
                            </div>

                            <div class="progress-visual">
                                <div class="progress-track">
                                    <div class="progress-fill" style="width: {{ progress_segment_percent|round(2) }}%;"></div>
                                </div>
                                <div class="progress-labels">
                                    <span>{{ progress_segment_start_label }} {{ progress_segment_start_points }} 點</span>
                                    <span>{{ progress_segment_end_label }} {{ progress_segment_end_points }} 點</span>
                                </div>
                            </div>

                            
                            <div class="section-title">徽章一覽</div>
                            <div class="badge-grid">
                                {% for badge in reward_badges %}
                                <div class="badge-card {{ 'unlocked' if badge.unlocked else 'locked' }} {% if next_badge and badge.points == next_badge.points %}next-target{% endif %}">
                                    {% if not badge.unlocked %}
                                    <span class="lock-icon">
                                        <span class="material-symbols-outlined" style="font-size: 18px;">lock</span>
                                    </span>
                                    {% endif %}
                                    <img src="{{ url_for('static', filename=badge.image) }}" alt="{{ badge.name }}" />
                                    <h4>{{ badge.name }}</h4>
                                    <p>達到 {{ badge.points }} 點</p>
                                    <p class="text-sm text-gray-600 mt-2 font-semibold">{{ badge.description }}</p>
                                </div>
                                {% endfor %}
                            </div>

                            <div class="actions-row">
                                <a href="{{ url_for('home') }}" class="btn-primary">
                                    <span class="material-symbols-outlined">home</span> 回到首頁
                                </a>
                                <a href="{{ url_for('upload_health') }}" class="btn-primary">
                                    <span class="material-symbols-outlined">cloud_upload</span> 上傳健檢報告
                                </a>
                            </div>
                        </div>
                    </div>
                </main>
            </div>
        </div>
        <script>
            const avatarInputs = document.querySelectorAll(".avatar-option input");
            avatarInputs.forEach((input) => {
                input.addEventListener("change", () => {
                    document.querySelectorAll(".avatar-option").forEach((opt) => opt.classList.remove("selected"));
                    input.closest(".avatar-option").classList.add("selected");
                });
            });

            const navToggle = document.getElementById("profile-nav-toggle");
            const navLinks = document.getElementById("profile-nav-links");
            navToggle?.addEventListener("click", () => {
                navLinks?.classList.toggle("open");
            });
        </script>
    </body>
</html>
