<!DOCTYPE html>
<html lang="zh-Hant">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>選擇頭像 - Meow Yourself</title>
        <style>
            @import url(https://fonts.googleapis.com/css2?family=Lato&display=swap);
            @import url(https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200);
            body {
                margin: 0;
                font-family: "Lato", "PingFang TC", "Microsoft JhengHei", sans-serif;
                background: linear-gradient(160deg, #f6ede6 0%, #ecd8cb 45%, #fdf8f4 100%);
                min-height: 100vh;
                color: #4a2f24;
            }
            .page-shell {
                max-width: 960px;
                margin: 0 auto;
                padding: 2rem 1.5rem 3rem;
            }
            header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding-bottom: 1rem;
                border-bottom: 1px solid rgba(203, 168, 144, 0.4);
                margin-bottom: 2rem;
            }
            header img.logo {
                height: calc(0.96rem + 1.6cm);
                width: auto;
            }
            nav a {
                margin-right: 1.5rem;
                text-decoration: none;
                color: #4a2f24;
                display: inline-flex;
                align-items: center;
                gap: 0.4rem;
                font-size: 0.95rem;
            }
            nav a:hover {
                color: #7a4d38;
            }
            .profile-thumb {
                height: 2.25rem;
                width: 2.25rem;
                border-radius: 999px;
                border: 1px solid rgba(148, 119, 99, 0.5);
                object-fit: cover;
            }
            .avatar-form {
                background: rgba(255, 255, 255, 0.92);
                border-radius: 1.5rem;
                padding: 2rem;
                box-shadow: 0 20px 45px rgba(210, 176, 157, 0.35);
            }
            .avatar-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 1.5rem;
                margin: 1.75rem 0;
            }
            .avatar-option {
                border: 2px solid transparent;
                border-radius: 1rem;
                padding: 1rem;
                text-align: center;
                transition: border 0.2s ease, transform 0.2s ease;
                cursor: pointer;
            }
            .avatar-option img {
                width: 144px;
                height: 144px;
                border-radius: 999px;
                border: 1px solid rgba(161, 130, 110, 0.3);
                object-fit: cover;
                background: radial-gradient(circle at center, #fef9f4 60%, #f6e8dd 100%);
                padding: 0.35rem;
                margin-bottom: 0.8rem;
            }
            .avatar-option input {
                display: none;
            }
            .avatar-option.selected {
                border-color: #f4b590;
                box-shadow: 0 15px 30px rgba(244, 181, 144, 0.35);
                transform: translateY(-4px);
            }
            .actions {
                display: flex;
                gap: 1rem;
                flex-wrap: wrap;
            }
            button,
            .secondary-link {
                border-radius: 999px;
                padding: 0.85rem 1.75rem;
                border: none;
                font-size: 1rem;
                cursor: pointer;
            }
            button {
                background: linear-gradient(120deg, #f1a97a 0%, #f7c8a0 100%);
                color: #4a2f24;
                font-weight: 600;
                border: 1px solid rgba(206, 154, 120, 0.6);
            }
            button:hover {
                box-shadow: 0 10px 20px rgba(240, 167, 122, 0.35);
            }
            .secondary-link {
                background: transparent;
                border: 1px solid rgba(158, 131, 112, 0.5);
                color: #6b4b38;
                text-decoration: none;
            }
            .secondary-link:hover {
                background: rgba(255, 255, 255, 0.6);
            }
            .flash {
                padding: 0.75rem 1rem;
                border-radius: 0.75rem;
                margin-bottom: 1rem;
                font-size: 0.95rem;
            }
            .flash.success {
                background: rgba(197, 243, 203, 0.65);
                color: #1d6b2d;
            }
            .flash.error {
                background: rgba(254, 215, 215, 0.8);
                color: #a62626;
            }
        </style>
    </head>
    <body>
        <div class="page-shell">
            <header>
                <img src="{{ url_for('static', filename='cat_cards/images/image-removebg-logo.png') }}" alt="Meow Yourself Logo" class="logo" />
                <nav class="hidden md:flex">
                    <a href="{{ url_for('home') }}"><span class="material-symbols-outlined">home</span> 首頁</a>
                    <a href="{{ url_for('badges') }}"><span class="material-symbols-outlined">workspace_premium</span> 我的徽章</a>
                </nav>
                <img src="{{ url_for('static', filename=user_avatar) }}" class="profile-thumb" alt="目前頭像" />
            </header>

            <section class="avatar-form">
                <h2 class="text-2xl font-semibold mb-2">選擇你的代表頭像</h2>
                <p class="text-gray-600">從下方四種風格挑選最符合你的貓奴身份，隨時都可以再更換。</p>

                {% with messages = get_flashed_messages(with_categories=True) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                {% endif %}
                {% endwith %}

                <form method="POST">
                    <div class="avatar-grid">
                        {% for option in avatar_options %}
                        <label class="avatar-option {{ 'selected' if option == current_avatar else '' }}">
                            <input type="radio" name="avatar" value="{{ option }}" {% if option == current_avatar %}checked{% endif %} />
                            <img src="{{ url_for('static', filename=option) }}" alt="頭像 {{ loop.index }}" />
                            <div>風格 {{ loop.index }}</div>
                        </label>
                        {% endfor %}
                    </div>
                    <div class="actions">
                        <button type="submit">更新頭像</button>
                        <a href="{{ url_for('badges') }}" class="secondary-link">返回我的徽章</a>
                    </div>
                </form>
            </section>
        </div>
        <script>
            document.querySelectorAll(".avatar-option input").forEach((input) => {
                input.addEventListener("change", () => {
                    document.querySelectorAll(".avatar-option").forEach((opt) => opt.classList.remove("selected"));
                    input.closest(".avatar-option").classList.add("selected");
                });
            });
        </script>
    </body>
</html>
